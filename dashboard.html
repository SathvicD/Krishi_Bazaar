<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>üåæ Farmer Dashboard</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

    <style>
        body {
            margin: 0;
            font-family: "Segoe UI", Arial, sans-serif;
            background: linear-gradient(to right, #f0fdf4, #e9f5ec);
        }

        h3 { margin-top: 0; color: #1b4332; }
        input, textarea {
            width: 92%;
            padding: 10px;
            margin: 8px 0;
            border-radius: 8px;
            border: 1px solid #b7e4c7;
            outline: none;
            transition: border 0.3s;
        }
        input:focus, textarea:focus { border-color: #52b788; }

        button {
            padding: 10px 18px;
            background: linear-gradient(to right, #40916c, #52b788);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        button:hover { transform: scale(1.05); box-shadow: 0 6px 15px rgba(0,0,0,0.2); }

        .top-bar {
            background: linear-gradient(to right, #2d6a4f, #40916c);
            color: white;
            padding: 14px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        .top-bar h2 { margin: 0; }
        .top-bar button { background: white; color: #2d6a4f; border-radius: 30px; }
        .top-bar button:hover { background: #95d5b2; }

        .main-layout { display: flex; gap: 20px; padding: 20px; }
        #map {
            width: 25%;
            min-height: 400px;
            border-radius: 12px;
            border: 3px solid #95d5b2;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        .container { flex: 1; display: flex; gap: 20px; }
        .left, .right {
            background: white;
            border-radius: 12px;
            padding: 18px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
        }
        .left:hover, .right:hover { transform: translateY(-3px); }
        .left { width: 35%; }
        .right { width: 65%; }

        .product-card {
            border-left: 6px solid #52b788;
            padding: 12px;
            margin-bottom: 12px;
            border-radius: 10px;
            background: #f0fdf4;
            transition: transform 0.3s;
        }
        .product-card:hover { transform: scale(1.03); }

        #farmerMobile { font-size: 18px; font-weight: bold; color: #40916c; background: #f0fdf4; padding: 8px; border-radius: 8px; text-align: center; }

        #noteDisplay {
            background: #f0fdf4;
            padding: 12px;
            border-radius: 10px;
            border-left: 6px solid #52b788;
            min-height: 50px;
            white-space: pre-wrap;
        }

        @media (max-width: 1000px) {
            .main-layout { flex-direction: column; }
            #map { width: 100%; }
            .container { flex-direction: column; }
            .left, .right { width: 100%; }
        }
    </style>
</head>

<body>

<!-- Top Bar -->
<div class="top-bar">
    <h2>üåæ Farmer Dashboard</h2>
    <button id="locateBtn">üìç Update Location</button>
</div>

<!-- Main Layout -->
<div class="main-layout">

    <!-- Map -->
    <div id="map"></div>

    <!-- Panels -->
    <div class="container">

        <!-- LEFT PANEL -->
        <div class="left">
            <h3>‚ûï Add / Update Product</h3>
            <h2>All prices for 1 KG</h2>
            <input id="productName" placeholder="Product Name">
            <input id="price" placeholder="Price">
            <button id="addProduct">Add / Update</button>

            <h3 style="margin-top:20px;">üü¢ Availability</h3>
            <button id="toggleAvailability">Toggle Available</button>

            <h3 style="margin-top:20px;">üìû Mobile Number</h3>
            <p id="farmerMobile">Loading...</p>

            <h3 style="margin-top:20px;">üìù Farmer Note</h3>
            <textarea id="farmerNote" placeholder="Write a note for customers (max 200 chars)" rows="4" maxlength="200"></textarea>
            <button id="saveNote">Save Note</button>
        </div>

        <!-- RIGHT PANEL -->
        <div class="right">
            <h3>üì¶ Your Products</h3>
            <div id="productList"></div>

            <h3 style="margin-top:25px;">üì¢ Note to Customers</h3>
            <div id="noteDisplay">No notes yet.</div>

            <h3 style="margin-top:25px;">üí¨ Consumer Messages</h3>
            <div id="messageList"></div>
        </div>

    </div>
</div>

<!-- Scripts -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script type="module">
    // ===== Map Initialization =====
    const map = L.map('map').setView([20.5937, 78.9629], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);

    document.getElementById('locateBtn').addEventListener('click', () => {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(pos => {
                const { latitude, longitude } = pos.coords;
                map.setView([latitude, longitude], 13);
                L.marker([latitude, longitude]).addTo(map).bindPopup("You are here").openPopup();
            });
        } else { alert("Geolocation not supported!"); }
    });

    // ===== Farmer Mobile Dummy =====
    const farmerMobileEl = document.getElementById('farmerMobile');
    farmerMobileEl.textContent = "+91 9876543210";

    // ===== Farmer Note Functionality =====
    const saveNoteBtn = document.getElementById('saveNote');
    const farmerNote = document.getElementById('farmerNote');
    const noteDisplay = document.getElementById('noteDisplay');

    saveNoteBtn.addEventListener('click', () => {
        const note = farmerNote.value.trim();
        if(note.length > 0){
            noteDisplay.textContent = note; // Live display to consumers
            farmerNote.value = ""; // optional: clear input
            alert("Note saved!");
            // TODO: Save to Firebase Firestore for persistence
            // Example:
            // await setDoc(doc(db, "farmers", farmerId), { note }, { merge: true });
        } else {
            alert("Please write something before saving.");
        }
    });

    // ===== Products Functionality =====
    const addProductBtn = document.getElementById('addProduct');
    const productNameInput = document.getElementById('productName');
    const priceInput = document.getElementById('price');
    const productList = document.getElementById('productList');
    const products = [];

    addProductBtn.addEventListener('click', () => {
        const name = productNameInput.value.trim();
        const price = priceInput.value.trim();
        if(name && price){
            const product = { name, price };
            products.push(product);
            renderProducts();
            productNameInput.value = "";
            priceInput.value = "";
        } else { alert("Please enter product name and price."); }
    });

    function renderProducts(){
        productList.innerHTML = "";
        products.forEach(p => {
            const div = document.createElement('div');
            div.classList.add('product-card');
            div.textContent = `${p.name} - ‚Çπ${p.price}`;
            productList.appendChild(div);
        });
    }

    // ===== Availability Toggle =====
    const toggleBtn = document.getElementById('toggleAvailability');
    let available = true;
    toggleBtn.addEventListener('click', () => {
        available = !available;
        alert(`Availability set to ${available ? "Available" : "Not Available"}`);
    });

</script>
<script type="module" src="js/dashboard.js"></script>
<script type="module" src="js/products.js"></script>
<script type="module" src="js/availability.js"></script>
<script type="module" src="js/farmerChat.js"></script>

</body>
</html>
